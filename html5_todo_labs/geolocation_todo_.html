<!DOCTYPE html>
<html>
<body>
<div id="tripmeter">
  <p>
    Starting Location (lat, lon):<br/>
    <span id="startLat">???</span>째, <span id="startLon">???</span>째
  </p>
  <p>
  
    <button onclick="clickCounter()" type="button">watch pos!</button>
    Current Location (lat, lon):<br/>
    <span id="currentLat">???</span>째, <span id="currentLon">???</span>째 <br/>
	<button onclick="stopWatch()" type="button">Clear watch!</button>
	
  </p>
  <p>
    Distance from starting location:<br/>
    <span id="distance">0</span> km
  </p>
</div>


<script>

//declare variable to store get position - starting latitude and longitude
var startlat,startlongi;
//declare variable to store geolocation object
var geoLoc;

//declare variable to store watch position id so that it can be passed to clearWatch() fucntion
var watchID;

//todo:fill in the blank preoperly so as to check for Geolocation support
if (------------.geolocation) {
  console.log('Geolocation is supported!');
}
else {
  console.log('Geolocation is not supported for this Browser/OS version yet.');
}

//todo:fill in the blank so as to start watching position of user
function clickCounter()
{
  geoLoc = navigator.--------;
  watchID = geoLoc.---------------(function(position) {
   alert('watch position');
   
   /* todo:fill in the blank properly so as to assign latitude and longitude of position object received to
      'currentLat' and 'currentLon' element in div */
	  
  document.getElementById('currentLat').innerHTML = position.----.-------;
  document.getElementById('currentLon').innerHTML = position.coords.longitude;
  document.getElementById('distance').innerHTML =
      calculateDistance(startlat, startlongi,
                        position.coords.latitude, position.coords.longitude);
});

 
}

//function to calculate the distance
 function calculateDistance(lat1, lon1, lat2, lon2) {
 
  var R = 6371; // km
  var dLat = (lat2 - lat1).toRad();
  var dLon = (lon2 - lon1).toRad(); 
  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
          Math.sin(dLon / 2) * Math.sin(dLon / 2); 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
  var d = R * c;
 //  alert(d);
  return d;
}
Number.prototype.toRad = function() {
  return this * Math.PI / 180;
}

/* on window onload event calculate the starting position by getting current position of user before he
starts moving */
window.onload = function() {
  var startPos;
  
  //todo:fill in the balnks properly
  navigator.geolocation.---------------------(function(---------) {
    startPos = position;
	alert('get position');
    document.getElementById('startLat').innerHTML = startPos.coords.latitude;
	lat=startPos.coords.latitude;
    document.getElementById('startLon').innerHTML = startPos.coords.longitude;
	longi=startPos.coords.longitude;
  },function(---------) {
    alert('Error occurred. Error code: ' + error.code);
    // error.code can be:
    //   0: unknown error
    //   1: permission denied
    //   2: position unavailable (error response from locaton provider)
    //   3: timed out
  });
};

/* todo:fill in the blank properly so as to clear the position watch passing watch id received
in watch position function */
function stopWatch(){
   alert('stop watch called');
   geoLoc.--------(-----------);
}
</script>
</body>
</html>
